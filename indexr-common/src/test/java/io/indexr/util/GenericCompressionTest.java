package io.indexr.util;

import org.apache.spark.unsafe.Platform;
import org.apache.spark.unsafe.array.ByteArrayMethods;
import org.junit.Assert;
import org.junit.Test;

public class GenericCompressionTest {
    @Test
    public void test() throws Exception {
        byte[] data = "{\"name\":\"custom_metric11\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric12\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric13\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric14\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric15\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric16\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric17\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric18\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric19\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric20\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric21\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric22\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric23\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric24\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric25\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric26\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric27\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric28\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric29\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric30\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric31\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric32\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric33\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric34\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric35\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric36\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric37\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric38\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric39\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric40\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric41\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric42\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric43\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric44\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric45\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric46\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric47\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric48\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric49\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric50\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric51\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric52\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric53\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric54\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric55\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric56\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric57\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric58\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric59\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric60\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric61\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric62\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric63\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric64\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric65\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric66\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric67\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric68\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric69\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric70\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric71\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric72\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric73\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric74\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric75\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric76\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric77\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric78\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric79\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric80\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric81\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric82\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric83\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric84\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric85\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric86\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric87\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric88\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric89\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric90\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric91\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric92\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric93\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric94\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric95\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric96\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric97\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric98\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric99\",\"dataType\":\"double\",\"default\":\"\"},{\"name\":\"custom_metric100\",\"dataType\":\"double\",\"default\":\"\"}]},\"rowCount\":21,\"columnNodes\":[{\"minNumValue\":20161222,\"maxNumValue\":20161222},{\"minNumValue\":8,\"maxNumValue\":10},{\"minNumValue\":1,\"maxNumValue\":12},{\"minNumValue\":1,\"maxNumValue\":17},{\"minNumValue\":0,\"maxNumValue\":44485305648673511},{\"minNumValue\":0,\"maxNumValue\":41450662273828800},{\"minNumValue\":0,\"maxNumValue\":0},{\"minNumValue\":0,\"maxNumValue\":0},{".getBytes("utf-8");
        byte[] cmpData = GenericCompression.compress(data);
        byte[] newData = GenericCompression.decomress(cmpData);
        boolean ok = ByteArrayMethods.arrayEquals(data, Platform.BYTE_ARRAY_OFFSET, newData, Platform.BYTE_ARRAY_OFFSET, data.length);
        Assert.assertArrayEquals(data, newData);
        Assert.assertEquals(true, ok);
    }
}
